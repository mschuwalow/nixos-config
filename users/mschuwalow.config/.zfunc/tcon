# Attach to running tmux sessions
if [[ -z "$TMUX" ]] && type -p tmux > /dev/null; then
    base_session='base'

    # Create a new session if it doesn't exist
    tmux has-session -t $base_session &> /dev/null || tmux new-session -d -s $base_session

    # Get ids of connected clients.
    sessions=$(tmux list-sessions -F "#{session_group}-#{session_id}" 2> /dev/null | grep $base_session | sed "s/${base_session}-\\$//")
		
    # get the maximum id from clients. The base session will always have an id).
    max_id=$(echo ${sessions[@]} | sort -n | tail -n1)
    # max_id=${max_id:=-1}
	
    # create a new session with max_id+1 (or 0 if no clients were found) and link it to the base session
	session_name=$base_session"-"$((max_id+1))}
       tmux new-session -d -t $base_session -s $session_name
       tmux -2 attach-session -t $session_name \; set-option destroy-unattached
    
else
	echo "tmux not found."
fi
